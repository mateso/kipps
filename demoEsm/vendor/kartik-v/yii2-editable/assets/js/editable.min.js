/*!
 * @package   yii2-editable
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2015
 * @version   1.7.1
 *
 * Editable Extension jQuery plugin
 *
 * Built for Yii Framework 2.0
 * Author: Kartik Visweswaran
 * Year: 2015
 * For more Yii related demos visit http://demos.krajee.com
 */!function(e){"use strict";var t=function(t,i){return null===t||void 0===t||0===t.length||i&&""===e.trim(t)},i=function(t,i){this.$element=e(t),this.init(i),this.listen()};i.prototype={constructor:i,init:function(t){var i=this;i.$container=e("#"+i.$element.attr("id")+"-cont"),i.$form=i.$container.find(".kv-editable-form"),i.$value=i.$container.find(".kv-editable-value"),i.$popover=i.$container.find(".kv-editable-popover"),i.$btnSubmit=i.$container.find("button.kv-editable-submit"),i.$btnReset=i.$container.find("button.kv-editable-reset"),i.$loading=i.$container.find(".kv-editable-loading"),i.$target=i.$container.find(t.target),e.each(t,function(e,t){i[e]=t})},refreshPosition:function(){var t,i=this,a=i.$popover,o=i.placement,r=i.$target,n=a[0].offsetWidth,l=a[0].offsetHeight,s=e.extend({},r.position(),{width:r[0].offsetWidth,height:r[0].offsetHeight});switch(o){case"bottom":t={top:s.top+s.height,left:s.left+s.width/2-n/2};break;case"top":t={top:s.top-l,left:s.left+s.width/2-n/2};break;case"left":t={top:s.top+s.height/2-l/2,left:s.left-n};break;case"right":t={top:s.top+s.height/2-l/2,left:s.left+s.width};break;default:throw"Invalid editable placement '"+o+"'!"}a.css(t)},listen:function(){var i,a,o=this,r=o.$form,n=o.$btnSubmit,l=o.$btnReset,s=r.parent(),d=o.$popover,c=o.$loading,h=o.$element,f=h.closest(".field-"+h.attr("id")),u=h.closest(".kv-editable-parent"),p=f.find(".help-block"),v=o.displayValueConfig,b=r.find('input[name="hasEditable"]'),m="",g="",k=o.$form.data("yiiActiveForm"),$=u.find(".kv-help-block"),y=t(f.attr("class"))||t(p.attr("class"));a=function(i){y?(t($.attr("class"))&&($=e(document.createElement("div")).attr({"class":"help-block kv-help-block"}).appendTo(u)),$.html(i)):p.html(i).removeClass("kv-help-block").addClass("kv-help-block"),u.addClass("has-error"),c.hide(),s.removeClass("kv-editable-processing")},r.on("submit",function(e){e.preventDefault()}).on("keyup",function(e){13===e.which&&n.trigger("click")}).on("reset",function(){setTimeout(function(){r.data("kvEditableSubmit",!1),y?(u.find(".help-block").remove(),u.removeClass("has-error")):(f.removeClass("has-error"),p.html(" ")),d.popoverX("refreshPosition")},200)}),r.find("input, select").on("change",function(){d.popoverX("refreshPosition"),h.trigger("editableChange",[h.val()])}),l.on("click",function(){b.val(0),setTimeout(function(){r[0].reset()},200),h.trigger("editableReset")}),n.on("click",function(){s.addClass("kv-editable-processing"),c.show(),b.val(1),r.find("input, select").each(function(){e(this).trigger("change")}),i=e.extend(o.ajaxSettings,{type:r.attr("method"),url:r.attr("action"),data:r.serialize(),dataType:"json",error:function(e,t,i){o.showAjaxErrors&&a(i),h.trigger("editableAjaxError",[e,t,i])},success:function(i){return g=t(i.output)?h.val():i.output,d.popoverX("refreshPosition"),t(i.message)?(t($.attr("class"))||(f.removeClass("has-error"),$.html("").hide(),p.html("")),r.find(".help-block").each(function(){m=e(this).text(),t(m.trim())||c.hide()}),t(m.trim())?(c.hide(),t(g)?g=o.valueIfNull:void 0!==v[g]&&(g=v[g]),y?(u.find(".help-block").remove(),u.removeClass("has-error"),p.html(""),d.popoverX("hide"),o.$value.html(g)):(f.removeClass("has-error"),p.html(""),d.popoverX("hide"),o.$value.html(g),k&&(r.yiiActiveForm("destroy"),r.yiiActiveForm(k.attributes,k.settings))),h.trigger("editableSuccess",[h.val(),r,i])):h.trigger("editableError",[h.val(),r,i]),void s.removeClass("kv-editable-processing")):(a(i.message),void h.trigger("editableError",[h.val(),r,i]))}}),e.ajax(i),h.trigger("editableSubmit",[h.val(),r])})}},e.fn.editable=function(t){var a=Array.apply(null,arguments);return a.shift(),this.each(function(){var o=e(this),r=o.data("editable"),n="object"==typeof t&&t;r||(r=new i(this,e.extend({},e.fn.editable.defaults,n,e(this).data())),o.data("editable",r)),"string"==typeof t&&r[t].apply(r,a)})},e.fn.editable.defaults={valueIfNull:"<em>(not set)</em>",placement:"right",displayValueConfig:{},ajaxSettings:{},showAjaxErrors:!0},e.fn.editable.Constructor=i}(window.jQuery);