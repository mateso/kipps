/*!
 * @package   yii2-grid
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014 - 2015
 * @version   3.0.6
 *
 * Grid grouping jquery library created for yii2-grid.
 * 
 * Author: Kartik Visweswaran
 * Copyright: 2015, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */var kvGridGroup=function(t){"use strict";!function(a){var e,r,n,o=a("#"+t),d={},i=[],s=0,u=(o.find("tr[data-key]:last").data("key"),o.find("tr.kv-page-summary")),c=o.find("tr[data-key]:first"),f=o.find("tr[data-key]:last"),l=function(t){return void 0===t||null===t||0===t.length},g=function(){var t=0;u.length&&u.find("td").each(function(){a(this).attr("data-col-seq",t),t++})},h=function(t,a,e,r){t=(t+"").replace(/[^0-9+\-Ee.]/g,"");var n=isFinite(+t)?+t:0,o=isFinite(+a)?Math.abs(a):0,d="undefined"==typeof r?",":r,i="undefined"==typeof e?".":e,s="",u=function(t,a){var e=Math.pow(10,a);return""+Math.round(t*e)/e};return s=(o?u(n,o):""+Math.round(n)).split("."),s[0].length>3&&(s[0]=s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,d)),(s[1]||"").length<o&&(s[1]=s[1]||"",s[1]+=new Array(o-s[1].length+1).join("0")),s.join(i)},p=function(t,e,r,n,o){var i,s,u;return e.format&&"number"===e.format?(i=e.decimals||0,s=e.decPoint||".",u=e.thousandSep||",",h(t,i,s,u)):e.format&&"callback"===e.format&&e.func&&a.isFunction(e.func)?(d=k(r,n,o),e.func(t,d)):t},v=function(t){var a,e,r,n=t.attr("data-sub-group-of"),o=0;if(l(n))return null;if(r='td[data-col-seq="'+n+'"]',a=t.closest("tr"),e=a.find(r),o=e.length,o>0)return e;for(;0===o&&a.length;)a=a.prev(),e=a.find(r),o=e.length;return 0===o?null:e},m=function(t,a){var e=t.attr("data-group-key"),r=0,n=a;if(a.attr("data-last-row"))return a;for(;0==r&&n.length;)n=a,a=a.next(),r=a.find('td[data-group-key="'+e+'"]').length;return n.length?n:f},k=function(t,e,r){var n=1,o=[],d=t,i=d.hasClass("kv-grid-group-row"),s=e.attr("rowspan")||1;if(i)for(n=!1,d=d.next(":not(.kv-grid-group-row");!n&&d.length;)d.find('td[data-col-seq="'+r+'"]').each(function(){var t=a(this).text().replace(/[\s,]+/g,"");t=parseFloat(t),o.push(t)}),n=d.hasClass("kv-grid-group-row"),d=d.next();else for(;s>=n&&d.length;)d.find('td[data-col-seq="'+r+'"]').each(function(){var t=a(this).text().replace(/[\s,]+/g,"");t=parseFloat(t),o.push(t)}),d=d.next(),n++;return o},y=function(t,e,r,n){var o,d,i,s=0;switch(t){case"f_count":case"f_sum":case"f_avg":case"f_max":case"f_min":switch(d=k(e,r,n),t){case"f_count":return d.length;case"f_sum":case"f_avg":return a.each(d,function(t,a){s+=a}),"f_sum"===t?s:(i=d.length,i?s/i:s);case"f_max":case"f_min":return o=t.replace("f_",""),Math[o].apply(null,d)}default:return t}},w=function(t,a){a=a||1;var e=t.attr("rowspan")||1;e=parseInt(e)+a,t.attr("rowspan",e)},q=function(){var t,e=[];if(f.nextAll("tr.kv-group-footer").each(function(){e.push(a(this))}),e.length)for(t=0;t<e.length;t++)f.after(e[t]);u.length&&u.find("td").each(function(){var t=a(this);c.find('td[data-col-seq="'+t.attr("data-col-seq")+'"]').length||t.remove()})},_=function(t,e){var r,n,o,d,i,s,u,f,l,g,h=t.data(e),k=!1,q="groupHeader"===e?"kv-group-header":"kv-group-footer";h&&(n=t.attr("data-group-key"),o=t.closest("tr"),n&&o.attr("data-group-key",n),r=t.attr("data-sub-group-of")?v(t):null,k=r&&r.length&&r.is("[data-grouped-row]"),n=r&&r.length?r.attr("data-col-seq"):null,u=a(document.createElement("tr")),h.options&&u.attr(h.options).addClass(q),c.find("td").each(function(){d=a(this),i=d.attr("data-col-seq"),(!n||i!=n||k)&&(f=a(document.createElement("td")).attr("data-summary-col-seq",i),h.content&&h.content[i]&&(g=y(h.content[i],o,t,i),h.contentFormats&&h.contentFormats[i]&&(g=p(g,h.contentFormats[i],o,t,i)),f.html(g)),h.contentOptions&&h.contentOptions[i]&&f.attr(h.contentOptions[i]),f.appendTo(u))}),r&&r.length&&!k&&w(r),"groupHeader"===e?(o.before(u),o.find('td[data-col-seq="'+n+'"]').length&&u.find("td").each(function(){var t=a(this),e=parseInt(t.attr("data-summary-col-seq"));return n=parseInt(n),e==n-1?void t.after(r):e==n+1?void t.before(r):void(e>n&&t.before(r))})):(l=m(t,o),k&&l.hasClass("kv-grid-group-row")?l.before(u):l.after(u)),h.mergeColumns&&h.mergeColumns.length&&a.each(h.mergeColumns,function(t,e){var r=e[0],n=e[1],o=0,i="";r>-1&&n>-1&&(u.find("td").each(function(){d=a(this),f,s=d.attr("data-summary-col-seq"),s>=r&&n>=s&&(i+=d.html(),o++)}),u.find("td").each(function(){d=a(this),f,s=d.attr("data-summary-col-seq"),s>r&&n>=s?d.remove():s==r&&d.attr("colspan",o).html(i)}))}))};for(g(),o.find("td.kv-grid-group").each(function(){var t=a(this),e=a(this).attr("data-group-key");e&&(a.inArray(e,i)<0&&i.push(e),void 0===d[e]?d[e]=[t]:d[e].push(t))}),a.each(i,function(t,e){var r,n,o=d[e],i=1,s=0,u="",c="",f="",l="";a.each(o,function(a,e){u=e.text().trim(),r=o[s],t>0?(n=v(e),n&&n.length&&(c=n.attr("data-cell-key")),l=c?c+"-"+u:u):l=u,e.attr("data-cell-key",l),l==f?(i++,r.attr("rowspan",i),e.addClass("kv-temp-cells").hide()):(s=a,i=1),f=l})}),o.find("td.kv-grid-group.kv-temp-cells").remove(),a.each(i,function(t,e){var r=0;o.find('td[data-group-key="'+e+'"]').each(function(){var t,e=a(this),n=(e.data("groupOptions"),e.attr(r%2>0?"data-odd-css":"data-even-css"));n&&e.removeClass(n).addClass(n),e.is("[data-grouped-row]")&&(t=a(document.createElement("tr")).addClass("kv-grid-group-row"),e.closest("tr").before(t),e.removeAttr("rowspan").appendTo(t).css("width","auto")),r++})}),e=o.find("tr.kv-grid-group-row"),e.length&&(s=o.find("tr[data-key]:first > td").length,s&&e.each(function(){a(this).find(">td").attr("colspan",s)}),e.find("td[data-group-key]").each(function(){var t=a(this).data("groupKey"),e=o.find(".kv-grid-group-header[data-group-key]"),r=o.find(".kv-grid-group-filter[data-group-key]");a(this).closest("tr").data("groupKey",t),e.length&&o.find('.kv-grid-group-header[data-group-key="'+t+'"]').remove(),r.length&&o.find('.kv-grid-group-filter[data-group-key="'+t+'"]').remove()})),f.attr("data-last-row",1),n=i.length-1,r=n;r>=0;r--)o.find('td[data-group-key="'+i[r]+'"]').each(function(){_(a(this),"groupFooter")});for(r=0;n>=r;r++)o.find('td[data-group-key="'+i[r]+'"]').each(function(){_(a(this),"groupHeader")});q()}(window.jQuery)};